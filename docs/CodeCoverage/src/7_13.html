<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\dev\ConvertX.To\src\Presentation\ConvertX.To.API\Controllers\V1\FileController.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using ConvertX.To.API.Contracts.V1;
using ConvertX.To.Application.Interfaces;
using Microsoft.AspNetCore.Mvc;
using MimeTypes.Core;

namespace ConvertX.To.API.Controllers.V1;

[ApiController]
public class FileController : ControllerBase
{
    private readonly IConversionService _conversionService;
    private readonly IConversionStorageService _conversionStorageService;

    public FileController(IConversionService conversionService, IConversionStorageService conversionStorageService)
    {
        _conversionService = conversionService;
        _conversionStorageService = conversionStorageService;
    }

    [HttpGet(ApiRoutesV1.Files.Get.Url)]
    public async Task&lt;IActionResult&gt; GetFileAsync([FromRoute] Guid conversionId)
    {
        if (!await _conversionService.ExistsAsync(conversionId)) return NotFound();

        var stream = (FileStream)_conversionStorageService.GetConvertedFile(conversionId);

        await _conversionService.IncrementDownloadCounter(conversionId);

        return new FileStreamResult(stream, MimeTypeMap.GetMimeType(Path.GetExtension(stream.Name)));
    }

    [HttpDelete(ApiRoutesV1.Files.Delete.Url)]
    public async Task&lt;IActionResult&gt; DeleteFileAsync([FromRoute] Guid conversionId)
    {
        if (!await _conversionService.ExistsAsync(conversionId)) return NotFound();

        _conversionStorageService.DeleteConvertedFile(conversionId);

        await _conversionService.DeleteAsync(conversionId);

        return Ok();
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[14,5,14,116,1],[15,5,15,6,1],[16,9,16,48,1],[17,9,17,62,1],[18,5,18,6,1],[22,5,22,6,1],[23,9,23,65,1],[23,66,23,84,1],[25,9,25,91,1],[27,9,27,73,1],[29,9,29,102,1],[30,5,30,6,1],[34,5,34,6,1],[35,9,35,65,1],[35,66,35,84,1],[37,9,37,69,1],[39,9,39,60,1],[41,9,41,21,1],[42,5,42,6,1]]);
    </script>
  </body>
</html>